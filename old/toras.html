<!DOCTYPE html>
<html lang="en">
	<style>
		#start_demo {
			width: 200px;
			height: 200px;
			position: absolute;
			top: 50%;
			left: 50%;
		}
	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.20/lodash.min.js" integrity="sha512-90vH1Z83AJY9DmlWa8WkjkV79yfS2n2Oxhsi2dZbIv0nC4E6m5AbH8Nh156kkM7JePmqD6tcZsfad1ueoaovww==" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" integrity="sha512-dLxUelApnYxpLt6K2iomGngnHO83iUvZytA3YjDUCjT0HDOHKXnVYdf3hU4JjM8uEhxf9nD1/ey98U3t2vZ0qQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<body>
		<script>
			let g = {};
			g.orien = {a: 0, b: 0, g: 0};
			function handleOrientation(event) {
				g.orien.a = event.alpha;
				g.orien.b = event.beta;
				g.orien.c = event.gamma;
				light.rotation.set(event.alpha, event.beta, event.gamma);
			}
			let start_btn = document.getElementById("start_demo");
			start_btn.onclick = function(e) {
				e.preventDefault();
				let dm = DeviceMotionEvent;
				let ty = typeof DeviceMotionEvent.requestPermission === "function";
				if (dm && ty) {
					DeviceMotionEvent.requestPermission();
				}
				start_btn.remove();
				window.addEventListener("deviceorientation", handleOrientation);
			};
		</script>
		<script>
			let camera, scene, renderer, light;
			init();
			function init() {
				let container = document.createElement( 'div' );
				document.body.appendChild( container );
				camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
				camera.position.set(0, 0, 400);
				camera.rotation.set(0, 0, 0);
				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0xa0a0a0 );
				// let light = new THREE.AmbientLight( 0xaaaaaa, 1.75 );
				// scene.add( light );
				let light = new THREE.DirectionalLight(0xffffff);
				let helper = new THREE.DirectionalLightHelper(light, 5);
				light.position.set(0, 0, 200);
				light.rotation.x = Math.PI / 2;
				let shita = 0;
				setInterval(e => {
					shita += Math.PI / 20.0;
					light.position.x = 50 * Math.cos(shita);
					light.position.y = 50 * Math.sin(shita);
				}, 100);
				scene.add(light);
				scene.add(helper);
				let grid = new THREE.GridHelper( 200, 20, 0x000000, 0x000000 );
				grid.material.opacity = 0.3;
				grid.material.transparent = true;
				grid.rotation.x = Math.PI / 2.0;
				scene.add( grid );
				let geo = new THREE.TorusGeometry(30, 10, 65, 100);
				let mat = new THREE.MeshStandardMaterial( {
					color: 0xff00ff,
					roughness: 0.5
					// side: THREE.DoubleSide
				} );
				let obj = new THREE.Mesh(geo, mat);
				scene.add(obj);
				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.shadowMap.enabled = true;
				renderer.physicallyCorrectLights = true;
				renderer.gammaFactor = 1.18;
				renderer.outputEncoding = THREE.sRGBEncoding;
				container.appendChild( renderer.domElement );
				renderer.setAnimationLoop( function () {
					renderer.render( scene, camera );
				} );
				window.addEventListener( 'resize', onWindowResize, false );
			}
			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
			}
		</script>

	</body>
</html>